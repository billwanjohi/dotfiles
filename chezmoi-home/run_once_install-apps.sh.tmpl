#!/usr/bin/env bash

set -Eeuxo pipefail

{{ if eq .chezmoi.os "darwin" -}}
if ! [ -x "$(command -v brew)" ]
then
    sudo chown "$(whoami)":admin \
        /usr/local/share/zsh \
        /usr/local/share/zsh/site-functions

    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# TODO: switch to brew bundle
# https://www.chezmoi.io/user-guide/machines/macos/#use-brew-bundle-to-manage-your-brews-and-casks

brew install --cask --no-quarantine \
    alacritty \
    amethyst \
    azure-data-studio \
    docker \
    figma \
    firefox \
    keepassxc \
    meetingbar \
    pomotroid \
    slack
    # aws-vault \
    # docker \
    # google-chrome \
    # jetbrains-toolbox \
    # microsoft-teams \
    # vscodium \
    # zoom

brew install \
    adr-tools \
    bat \
    bottom \
    coreutils \
    defaultbrowser \
    editorconfig \
    fzf \
    git-lfs \
    gnupg \
    graphviz \
    microsoft/mssql-release/mssql-tools \
    node@16 \
    httpie \
    pandoc \
    prettier \
    sqlfluff \
    tldr \
    tig \
    tmux
    # awscli \
    # git \
    # jmespath/jmespath/jp \
    # lazydocker \
    # lazygit \
    # node@16 \
    # pandoc \
    # prettier \
    # _shellcheck \

$(brew --prefix)/opt/fzf/install

defaultbrowser firefox

{{ else -}}
yay --sync --needed \
    bat \
    tldr

{{ end -}}
curl -sLf https://spacevim.org/install.sh | bash
