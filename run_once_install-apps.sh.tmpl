#!/usr/bin/env bash

set -Eeuxo pipefail

{{ if eq .chezmoi.os "darwin" -}}
if ! [ -x "$(command -v brew)" ]
then
    sudo chown "$(whoami)":admin \
        /usr/local/share/zsh \
        /usr/local/share/zsh/site-functions

    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# TODO: switch to brew bundle
# https://www.chezmoi.io/user-guide/machines/macos/#use-brew-bundle-to-manage-your-brews-and-casks

brew install --cask --no-quarantine \
    alacritty \
    amethyst \
    firefox \
    keepassxc \
    meetingbar \
    pomotroid
    # aws-vault \
    # docker \
    # google-chrome \
    # jetbrains-toolbox \
    # microsoft-teams \
    # vscodium \
    # zoom

brew install \
    bat \
    coreutils \
    defaultbrowser \
    editorconfig \
    gnupg \
    graphviz \
    node@16 \
    httpie \
    pandoc \
    prettier \
    tldr \
    tmux
    # awscli \
    # fzf \
    # git \
    # jmespath/jmespath/jp \
    # lazydocker \
    # lazygit \
    # node@16 \
    # pandoc \
    # prettier \
    # _shellcheck \

defaultbrowser firefox

{{ else -}}
yay --sync --needed \
    bat \
    tldr

{{ end -}}
