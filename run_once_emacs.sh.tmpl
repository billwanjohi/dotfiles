#!/usr/bin/env bash

set -Eeuxo pipefail

{{ if eq .chezmoi.os "darwin" -}}
if ! [ -x "$(command -v brew)" ]
then
    sudo chown "$(whoami)":admin \
        /usr/local/share/zsh \
        /usr/local/share/zsh/site-functions

    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

brew install \
    bashdb \
    fd \
    homebrew/cask-fonts/font-space-mono-nerd-font \
    pandoc \
    plantuml \
    prettier \
    ripgrep \
    shellcheck

brew install --cask --no-quarantine emacs
yarn global add bash-language-server

{{ else -}}
yay --sync --needed \
    bash-language-server \
    emacs \
    fd \
    nerd-fonts-space-mono \
    ripgrep \
    shellcheck

{{ end -}}

EMACS_DIR=$HOME/.emacs.d

if [[ ! -d $EMACS_DIR ]]
then
    git clone --depth 1 https://github.com/hlissner/doom-emacs $EMACS_DIR
    $EMACS_DIR/bin/doom install
fi
